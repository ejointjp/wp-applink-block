(()=>{"use strict";function e(e,t,n,r,a,l,o){try{var i=e[l](o),c=i.value}catch(e){return void n(e)}i.done?t(c):Promise.resolve(c).then(r,a)}function t(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,a,l=[],o=!0,i=!1;try{for(n=n.call(e);!(o=(r=n.next()).done)&&(l.push(r.value),!t||l.length!==t);o=!0);}catch(e){i=!0,a=e}finally{try{o||null==n.return||n.return()}finally{if(i)throw a}}return l}}(e,t)||function(e,t){if(e){if("string"==typeof e)return n(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?n(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function n(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var r=wp.blockEditor,a=r.useBlockProps,l=r.PlainText,o=wp.element,i=o.useState,c=o.useEffect,u=(o.useMemo,o.useCallback),p=o.memo,s=wpalbAjaxValues,m=s.api,d=s.action,f=s.nonce;var w=wp.blockEditor.useBlockProps;(0,wp.blocks.registerBlockType)("merihari/applink",{apiVersion:2,title:"アプリリンク",description:"",category:"merihari",icon:"instagram",supports:{html:!1},keywords:["リンク","埋め込み","アプリ","apple","app","embed","link"],attributes:{app:{type:"object",default:{}}},edit:function(n){var r=a(),o=n.attributes,s=n.setAttributes,w=o.app,v=t(i(""),2),h=v[0],y=v[1],b=t(i(""),2),k=b[0],g=b[1],E=t(i({}),2),j=E[0],P=E[1],x=function(){var t,n=(t=regeneratorRuntime.mark((function e(){var t,n,r,a,l;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(t=new URLSearchParams).append("country","JP"),t.append("lang","ja_JP"),t.append("entity","software"),t.append("term",h),t.append("limit","10"),t.append("at","11l64V"),n="https://itunes.apple.com/search?"+t.toString(),(r=new URLSearchParams).append("action",d),r.append("nonce",f),r.append("url",n),e.next=14,fetch(m,{method:"post",body:r});case 14:return a=e.sent,e.next=17,a.json();case 17:return l=e.sent,e.next=20,P(l);case 20:case"end":return e.stop()}}),e)})),function(){var n=this,r=arguments;return new Promise((function(a,l){var o=t.apply(n,r);function i(t){e(o,a,l,i,c,"next",t)}function c(t){e(o,a,l,i,c,"throw",t)}i(void 0)}))});return function(){return n.apply(this,arguments)}}(),S=u((function(e){console.log("clicked"),s({app:{title:e.trackName,url:e.trackViewUrl,artist:e.artistName,artwork:e.artworkUrl100}})})),A=p((function(){return Object.keys(w).length>0?wp.element.createElement("div",null,wp.element.createElement("div",null,w.title),wp.element.createElement("div",null,w.artist),wp.element.createElement("div",null,wp.element.createElement("img",{src:w.artworkUrl,alt:"","aria-hidden":"true"})),wp.element.createElement("div",null,wp.element.createElement("a",{href:w.url,target:"_blank",rel:"noopener noreferrer"},"リンク"))):wp.element.createElement("div",null,"appありません")})),U=p((function(){return Object.keys(j).length>0&&-1!==Object.keys(j).indexOf("results")?j.results.map((function(e,t){return wp.element.createElement("div",{key:t},wp.element.createElement("div",{style:{width:"1rem",height:"1rem"}},wp.element.createElement("img",{src:e.artworkUrl100})),wp.element.createElement("div",null,e.trackName),wp.element.createElement("button",{className:"button",onClick:function(){return S(e)}},"これにする"))})):wp.element.createElement("div",null,"resultありません")}));return c((function(){console.log("term",h),""!==h?(x(),console.log("fetchしました")):console.log("fetchしませんでした")}),[h]),wp.element.createElement("div",r,wp.element.createElement("div",{className:"wp-block-merihari-blogcard-url"},wp.element.createElement(l,{className:"wp-block-merihari-blogcard-input",tagName:"input",placeholder:"URLを入力してEnter",value:k,onChange:function(e){return g(e)},onKeyPress:function(e){if("Enter"===e.key){if(e.preventDefault(),""===k)return!1;y(k)}}})),wp.element.createElement(A,null),wp.element.createElement(U,null))},save:function(e){var t=w.save();return wp.element.createElement("div",t,"save")}})})();
//# sourceMappingURL=index.js.map