{"version":3,"file":"index.js","mappings":"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","sources":["webpack://wp-applink-block/./src/js/edit.js","webpack://wp-applink-block/./src/js/save.js","webpack://wp-applink-block/./src/js/index.js","webpack://wp-applink-block/./src/js/attributes.js"],"sourcesContent":["const { useBlockProps, PlainText } = wp.blockEditor\nconst { useState, useEffect, useMemo, useCallback, memo } = wp.element\n\n// PHPから取得した変数\n// eslint-disable-next-line no-undef\nconst { api, action, nonce } = wpalbAjaxValues\n\nconst edit = (props) => {\n  const blockProps = useBlockProps()\n  const { attributes, setAttributes } = props\n  const { app } = attributes\n\n  const [term, setTerm] = useState('')\n  const [tempTerm, setTempTerm] = useState('')\n  const [result, setResult] = useState({})\n\n  const fetchData = async () => {\n    const searchParams = new URLSearchParams()\n    searchParams.append('country', 'JP')\n    searchParams.append('lang', 'ja_JP')\n    searchParams.append('entity', 'software')\n    searchParams.append('term', term)\n    searchParams.append('limit', '10')\n    searchParams.append('at', '11l64V')\n\n    const url = 'https://itunes.apple.com/search?' + searchParams.toString()\n    const params = new URLSearchParams()\n    params.append('action', action)\n    params.append('nonce', nonce)\n    params.append('url', url)\n\n    const res = await fetch(api, { method: 'post', body: params })\n    const result = await res.json()\n    await setResult(result)\n  }\n\n  const onKeyPress = (e) => {\n    // URL入力してEnterを押したら\n    if (e.key === 'Enter') {\n      e.preventDefault()\n\n      // URLが空なら\n      if (tempTerm === '') {\n        // setState('url-empty')\n        return false\n      }\n\n      // 入力URLを実際のURLに渡す（検索がはじまる）\n      setTerm(tempTerm)\n      // 検索モード\n      // setState('search')\n    }\n  }\n\n  const onClickAppButton = useCallback((item) => {\n    console.log('clicked')\n    // useEffect(() => {\n    setAttributes({\n      app: {\n        title: item.trackName,\n        url: item.trackViewUrl,\n        artist: item.artistName,\n        artwork: item.artworkUrl100\n      }\n    })\n    // }, [])\n  })\n\n  const ResultApp = memo(() => {\n    if (Object.keys(app).length > 0) {\n      return (\n        <div>\n          <div>{app.title}</div>\n          <div>{app.artist}</div>\n          <div><img src={app.artworkUrl} alt=\"\" aria-hidden=\"true\" /></div>\n          <div><a href={app.url} target=\"_blank\" rel=\"noopener noreferrer\">リンク</a></div>\n        </div>\n      )\n    } else {\n      return <div>appありません</div>\n    }\n  })\n\n  const ResultList = memo(() => {\n    if (Object.keys(result).length > 0 && Object.keys(result).indexOf('results') !== -1) {\n      return (\n        result.results.map((item, i) =>\n\n          <div key={i}>\n            <div style={{ width: '1rem', height: '1rem' }}><img src={item.artworkUrl100} /></div>\n            <div>{item.trackName}</div>\n            <button\n              className=\"button\"\n              onClick={() => onClickAppButton(item)}\n            >これにする</button>\n          </div>\n        ))\n    } else {\n      return <div>resultありません</div>\n    }\n  })\n\n  // URLが有効ならfetch\n  useEffect(() => {\n    console.log('term', term)\n    if (term !== '') {\n      fetchData()\n      console.log('fetchしました')\n    } else {\n      console.log('fetchしませんでした')\n    }\n  }, [term])\n\n  return (\n    <div { ...blockProps }>\n      <div className='wp-block-merihari-blogcard-url'>\n        <PlainText\n        className='wp-block-merihari-blogcard-input'\n        tagName='input'\n        placeholder='URLを入力してEnter'\n        value={ tempTerm }\n        onChange={ (value) => setTempTerm(value) }\n        onKeyPress={onKeyPress}\n      />\n      </div>\n      <ResultApp />\n      <ResultList />\n    </div>\n  )\n}\n\nexport default edit\n","// import he from 'he'\n// import { getDomainFromUrl, faviconUrl } from './util'\nconst { useBlockProps } = wp.blockEditor\n\nexport default function save (props) {\n  const blockProps = useBlockProps.save()\n\n  return <div {...blockProps}>save</div>\n}\n","import attributes from './attributes'\nimport edit from './edit'\nimport save from './save'\nconst { registerBlockType } = wp.blocks\n\nregisterBlockType('merihari/applink', {\n  apiVersion: 2,\n  title: 'アプリリンク',\n  description: '',\n  category: 'merihari',\n  icon: 'instagram',\n  supports: { html: false },\n  keywords: [\n    'リンク',\n    '埋め込み',\n    'アプリ',\n    'apple',\n    'app',\n    'embed',\n    'link'\n  ],\n  attributes,\n  edit,\n  save\n})\n","export default {\n\n  app: {\n    type: 'object',\n    default: {}\n  }\n}\n"],"names":["wp","blockEditor","useBlockProps","PlainText","element","useState","useEffect","useCallback","useMemo","memo","wpalbAjaxValues","api","action","nonce","registerBlockType","blocks","apiVersion","title","description","category","icon","supports","html","keywords","attributes","app","type","default","edit","props","blockProps","setAttributes","term","setTerm","tempTerm","setTempTerm","result","setResult","fetchData","searchParams","URLSearchParams","append","url","toString","params","fetch","method","body","res","json","onClickAppButton","item","console","log","trackName","trackViewUrl","artist","artistName","artwork","artworkUrl100","ResultApp","Object","keys","length","src","artworkUrl","alt","href","target","rel","ResultList","indexOf","results","map","i","key","style","width","height","className","onClick","tagName","placeholder","value","onChange","onKeyPress","e","preventDefault","save"],"sourceRoot":""}