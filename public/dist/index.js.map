{"version":3,"file":"index.js","mappings":"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","sources":["webpack://wp-applink-block/./src/js/edit.js","webpack://wp-applink-block/./src/js/save.js","webpack://wp-applink-block/./src/js/index.js","webpack://wp-applink-block/./src/js/attributes.js"],"sourcesContent":["const { useBlockProps, PlainText, InspectorControls } = wp.blockEditor\nconst { useState, useEffect, useCallback, memo } = wp.element\nconst { Button, PanelBody, SelectControl } = wp.components\nconsole.log(wp.components)\n// PHPから取得した変数\n// eslint-disable-next-line no-undef\nconst { api, action, nonce } = wpalbAjaxValues\n\nconst edit = (props) => {\n  const blockProps = useBlockProps()\n  const { attributes, setAttributes } = props\n  const { app } = attributes\n\n  const [term, setTerm] = useState('')\n  const [tempTerm, setTempTerm] = useState('')\n  const [result, setResult] = useState({})\n  const [entity, setEntity] = useState('software')\n\n  const fetchData = async () => {\n    const searchParams = new URLSearchParams()\n    searchParams.append('country', 'JP')\n    searchParams.append('lang', 'ja_JP')\n    searchParams.append('entity', entity)\n    searchParams.append('term', term)\n    searchParams.append('limit', '10')\n    searchParams.append('at', '11l64V')\n\n    const url = 'https://itunes.apple.com/search?' + searchParams.toString()\n    const params = new URLSearchParams()\n    params.append('action', action)\n    params.append('nonce', nonce)\n    params.append('url', url)\n\n    try {\n      const res = await fetch(api, { method: 'post', body: params })\n      const result = await res.json()\n      await setResult(result)\n      console.log(url)\n    } catch (e) {\n      console.error(e)\n    }\n  }\n\n  const onKeyPress = (e) => {\n    // URL入力してEnterを押したら\n    if (e.key === 'Enter') {\n      e.preventDefault()\n\n      // URLが空なら\n      if (tempTerm === '') {\n        // setState('url-empty')\n        return false\n      }\n\n      // 入力URLを実際のURLに渡す（検索がはじまる）\n      setTerm(tempTerm)\n      // 検索モード\n      // setState('search')\n    }\n  }\n\n  const onClickAppButton = useCallback((item) => {\n    setAttributes({\n      app: {\n        title: item.trackName,\n        url: item.trackViewUrl,\n        artist: item.artistName,\n        artworkUrl: item.artworkUrl100 || item.artworkUrl512 || item.artworkUrl60 || item.artworkUrl30\n      }\n    })\n    console.log('clicked')\n  })\n\n  const ResultApp = memo(() => {\n    if (Object.keys(app).length > 0) {\n      return (\n        <div>\n          <div>{app.title}</div>\n          <div>{app.artist}</div>\n          <div><img src={app.artworkUrl} alt=\"\" aria-hidden=\"true\" /></div>\n          <div><a href={app.url} target=\"_blank\" rel=\"noopener noreferrer\">リンク</a></div>\n        </div>\n      )\n    } else {\n      return <div>appありません</div>\n    }\n  })\n\n  const ResultList = memo(() => {\n    if (Object.keys(result).length > 0 && Object.keys(result).indexOf('results') !== -1) {\n      return (\n        result.results.map((item, i) =>\n\n          <div key={i}>\n            <div style={{ width: '1rem', height: '1rem' }}><img src={item.artworkUrl100} /></div>\n            <div>{item.trackName}</div>\n            <button\n              className=\"button\"\n              onClick={() => onClickAppButton(item)}\n            >これにする</button>\n          </div>\n        ))\n    } else {\n      return <div>resultありません</div>\n    }\n  })\n\n  // URLが有効ならfetch\n  useEffect(() => {\n    console.log('term', term)\n    if (term !== '') {\n      fetchData()\n      console.log('fetchしました')\n    } else {\n      console.log('fetchしませんでした')\n    }\n  }, [term, entity])\n\n  return (\n    <div { ...blockProps }>\n      <div className='wp-block-merihari-blogcard-url'>\n        <SelectControl\n          label=\"選べ\"\n          value={entity}\n          onChange={ (value) => setEntity(value) }\n          options={ [\n            {\n              value: 'software',\n              label: 'iPhone App'\n            },\n            {\n              value: 'iPadSoftware',\n              label: 'iPad App'\n            },\n            {\n              value: 'macSoftware',\n              label: 'Mac App'\n            },\n            {\n              value: 'movie',\n              label: 'ムービー'\n            },\n            {\n              value: 'audiobook',\n              label: 'AudioBook'\n            },\n            {\n              value: 'podcast',\n              label: 'Podcast'\n            },\n            {\n              value: 'tvEpisode',\n              label: 'TV Episode'\n            },\n            {\n              value: 'ebook',\n              label: 'ブック'\n            },\n            {\n              value: 'musicArtist',\n              label: '音楽アーティスト'\n            },\n            {\n              value: 'musicTrack',\n              label: '音楽トラック'\n            },\n            {\n              value: 'album',\n              label: '音楽アルバム'\n            },\n            {\n              value: 'musicVideo',\n              label: 'ミュージックビデオ'\n            }\n          ] }\n        />\n\n        <PlainText\n        className='wp-block-merihari-blogcard-input'\n        tagName='input'\n        placeholder='URLを入力してEnter'\n        value={ tempTerm }\n        onChange={ (value) => setTempTerm(value) }\n        onKeyPress={onKeyPress}\n      />\n      </div>\n      <ResultApp />\n      <ResultList />\n    </div>\n  )\n}\n\nexport default edit\n","// import he from 'he'\n// import { getDomainFromUrl, faviconUrl } from './util'\nconst { useBlockProps } = wp.blockEditor\n\nexport default function save (props) {\n  const blockProps = useBlockProps.save()\n\n  return <div {...blockProps}>save</div>\n}\n","import attributes from './attributes'\nimport edit from './edit'\nimport save from './save'\nconst { registerBlockType } = wp.blocks\n\nregisterBlockType('merihari/applink', {\n  apiVersion: 2,\n  title: 'アプリリンク',\n  description: '',\n  category: 'merihari',\n  icon: 'instagram',\n  supports: { html: false },\n  keywords: [\n    'リンク',\n    '埋め込み',\n    'アプリ',\n    'apple',\n    'app',\n    'embed',\n    'link'\n  ],\n  attributes,\n  edit,\n  save\n})\n","export default {\n\n  app: {\n    type: 'object',\n    default: {}\n  }\n}\n"],"names":["wp","blockEditor","useBlockProps","PlainText","InspectorControls","element","useState","useEffect","useCallback","memo","components","SelectControl","Button","PanelBody","console","log","wpalbAjaxValues","api","action","nonce","registerBlockType","blocks","apiVersion","title","description","category","icon","supports","html","keywords","attributes","app","type","default","edit","props","blockProps","setAttributes","term","setTerm","tempTerm","setTempTerm","result","setResult","entity","setEntity","fetchData","searchParams","URLSearchParams","append","url","toString","params","fetch","method","body","res","json","error","onClickAppButton","item","trackName","trackViewUrl","artist","artistName","artworkUrl","artworkUrl100","artworkUrl512","artworkUrl60","artworkUrl30","ResultApp","Object","keys","length","src","alt","href","target","rel","ResultList","indexOf","results","map","i","key","style","width","height","className","onClick","label","value","onChange","options","tagName","placeholder","onKeyPress","e","preventDefault","save"],"sourceRoot":""}